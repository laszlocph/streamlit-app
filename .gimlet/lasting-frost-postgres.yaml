app: postgres
env: lasting-frost
namespace: default
manifests: |
  ---
  apiVersion: source.toolkit.fluxcd.io/v1
  kind: HelmRepository
  metadata:
    name: postgres
    namespace: default
  spec:
    interval: 360m
    url: https://charts.bitnami.com/bitnami
  ---
  apiVersion: helm.toolkit.fluxcd.io/v2
  kind: HelmRelease
  metadata:
    name: postgres
    namespace: default
  spec:
    interval: 60m
    releaseName: postgres
    chart:
      spec:
        chart: postgresql
        version: 15.5.31
        sourceRef:
          kind: HelmRepository
          name: postgres
        interval: 10m
    values:
      commonAnnotations:
        gimlet.io/git-repository: laszlocph/streamlit-app
        gimlet.io/git-sha: '{{ .SHA }}'
        gimlet.io/app: postgres
      auth:
        existingSecret: postgres
      architecture: standalone
      tls:
        enabled: true
        autoGenerated: true
      persistence:
        enabled: true
        size: 8Gi
      persistentVolumeClaimRetentionPolicy:
        enabled: true
        whenScaled: Retain
        whenDeleted: Retain
  ---
  apiVersion: bitnami.com/v1alpha1
  kind: SealedSecret
  metadata:
    name: postgres
    namespace: default
    annotations:
      sealedsecrets.bitnami.com/cluster-wide: "true"
  spec:
    encryptedData:
      postgres-password: AgDIOrIf0L8G0goWiuncir26s+IObc+t8HQ9bB5kF+uk1QEK77z43NWNahn5q8cgB8TKIyJGJcys86Damva9wSe2EuDxMJPBH3pXAOXf0U+2xHomuOMLU7XOzbbVl9f/Sk+0KrswXIWmubVcLbWN8hmdlnHymYP83WiKVHFAoFxFrK07sLTpnNGUW35NSiqtJ/n+GTRoDEGFyoJ4KZYkyXUdD7hGOLRdwQC39jKA6P2vmCTcRVVbbgBjHcYzC4Zdp86Eym1PevV6SvT00eDb4boTbucdb1DYMAEfTQ9xIRjG3dhPfK1wmt81tl1GUxsf75RSLlmhsXdkN9574GK5hwBhOdxwKyrVwtR6JzN/ZPYjzcdrXUuUFm4oy42jzb7RgU4cA7JmL6sKjtV3F6ZUrhyKKcMsAwjpA2v7bhx4ccN6B28GAr/Mvd9tIx7pXnIlEuSJNVZVSViOBwrW0cZzekNswDsCEDx5ZZFNBlzPKucZLUORf/mLMt5puk0RmBscqJWOgeX6UE3eM2Shkpxztak6pPmoWe0NM2rnAJNAS6QLzMfLLVXf9/sENh49R9V6P/YRHNS9oDMHE9qAZoKNbmrTyCUI5ZT4EYMRwLFPzvdV6JwI5oUQzEq9lvmqzx0EWpC/tvhDAFSHXYWsG4c1CMhYfLS3xdp0bqJZJDqcJJuxJPnXRSNB8rmTQ+Z2KdbGOYw4O52/ozMXbsdgPQEXNfv58dMpykc+5IajMIbTFzEp1FFUxj8pvMkL
      pgadmin-password: AgDIOrIf0L8G0goWiuncir26s+IObc+t8HQ9bB5kF+uk1QEK77z43NWNahn5q8cgB8TKIyJGJcys86Damva9wSe2EuDxMJPBH3pXAOXf0U+2xHomuOMLU7XOzbbVl9f/Sk+0KrswXIWmubVcLbWN8hmdlnHymYP83WiKVHFAoFxFrK07sLTpnNGUW35NSiqtJ/n+GTRoDEGFyoJ4KZYkyXUdD7hGOLRdwQC39jKA6P2vmCTcRVVbbgBjHcYzC4Zdp86Eym1PevV6SvT00eDb4boTbucdb1DYMAEfTQ9xIRjG3dhPfK1wmt81tl1GUxsf75RSLlmhsXdkN9574GK5hwBhOdxwKyrVwtR6JzN/ZPYjzcdrXUuUFm4oy42jzb7RgU4cA7JmL6sKjtV3F6ZUrhyKKcMsAwjpA2v7bhx4ccN6B28GAr/Mvd9tIx7pXnIlEuSJNVZVSViOBwrW0cZzekNswDsCEDx5ZZFNBlzPKucZLUORf/mLMt5puk0RmBscqJWOgeX6UE3eM2Shkpxztak6pPmoWe0NM2rnAJNAS6QLzMfLLVXf9/sENh49R9V6P/YRHNS9oDMHE9qAZoKNbmrTyCUI5ZT4EYMRwLFPzvdV6JwI5oUQzEq9lvmqzx0EWpC/tvhDAFSHXYWsG4c1CMhYfLS3xdp0bqJZJDqcJJuxJPnXRSNB8rmTQ+Z2KdbGOYw4O52/ozMXbsdgPQEXNfv58dMpykc+5IajMIbTFzEp1FFUxj8pvMkL
    template:
      metadata:
        name: postgres
        namespace: default
  ---
  apiVersion: source.toolkit.fluxcd.io/v1
  kind: HelmRepository
  metadata:
    name: runix
    namespace: default
  spec:
    interval: 60m
    url: https://helm.runix.net
  ---
  apiVersion: helm.toolkit.fluxcd.io/v2
  kind: HelmRelease
  metadata:
    name: pgadmin
    namespace: default
  spec:
    interval: 360m
    releaseName: pgadmin
    chart:
      spec:
        chart: pgadmin4
        version: 1.31.0
        sourceRef:
          kind: HelmRepository
          name: runix
        interval: 60m
    values:
      existingSecret: postgres
      secretKeys:
        pgadminPasswordKey: pgadmin-password
      service:
        annotations:
          gimlet.io/git-repository: laszlocph/streamlit-app
          gimlet.io/git-sha: '{{ .SHA }}'
          gimlet.io/app: postgres
  ---
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: pgadmin
    namespace: default
    annotations:
      kubernetes.io/ingress.class: nginx
  spec:
    tls:
      - hosts:
          - "pgadmin-eyujopnt.gimlet.app"
        secretName: tls-pgadmin
    rules:
      - host: "pgadmin-eyujopnt.gimlet.app"
        http:
          paths:
            - path: "/"
              pathType: "Prefix"
              backend:
                service:
                  name: pgadmin-pgadmin4
                  port:
                    number: 80
